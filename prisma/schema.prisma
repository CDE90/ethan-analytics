generator kysely {
    provider = "pnpm prisma-kysely"
    output   = "../src/server/db"
}

generator rust {
    provider = "cargo prisma"
    output   = "../src/db.rs"
}

datasource db {
    provider     = "mysql"
    url          = env("DATABASE_URL")
    relationMode = "prisma"
}

model Example {
    id   Int    @id @default(autoincrement())
    name String
    age  Int
}

model User {
    id      Int    @id @default(autoincrement())
    clerkId String @unique

    Website Website[]
}

model Website {
    id   Int    @id @default(autoincrement())
    url  String @unique
    name String

    user   User    @relation(fields: [userId], references: [id])
    userId Int
    events Event[]

    @@index([userId, url])
}

model Event {
    id        Int      @id @default(autoincrement())
    timestamp DateTime @default(now())
    url       String
    userAgent String?
    referrer  String?
    region    String?
    city      String?
    country   String?
    eventType String

    website Website @relation(fields: [host], references: [url])
    host    String  @map("websiteUrl")

    @@index([host, url])
}
